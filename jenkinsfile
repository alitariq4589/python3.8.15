node ('Runner2'){
    checkout scm //Getting content of this repo
    stage('*** PRE-BUILD SETTING ***') { // for display purposes
        //Setting up directory tree using bash commands
        sh '''#!/bin/bash
        	echo -e "[jenkinsfile INFO]: Saving current directory to shell variable $PROJECT_DIR."
			PROJECT_DIR=$(pwd)
			echo -e "[jenkinsfile INFO]: Creating installation directory"
			mkdir path_to_install
			cd path_to_install #Python will be installed here
			echo -e "[jenkinsfile INFO]: Saving installation directory to shell variable $PREFIX"
			PREFIX=$(pwd)
			cd $PROJECT_DIR
			echo -e "[jenkinsfile VIP INFO]: Jenkinsfile has no way to export variables from one shell instant to another or modifying groovy variables inside bash shell instance."
			echo -e "[jenkinsfile INFO]: Creating a separate file .vars for saving shell variable for later use."
			echo "PREFIX=$PREFIX" > .vars
			echo "PROJECT_DIR=$PROJECT_DIR" >> .vars
         '''
    }
    stage (' *** CONFIGURATION PHASE ***'){
        sh '''#!/bin/bash
		source .vars
		echo -e "[jenkinsfile INFO]: Running configure file"
		./configure --host=riscv64-unknown-linux-gnu --build=x86_64-linux-gnu --prefix=$PREFIX --disable-ipv6 ac_cv_file__dev_ptmx=no ac_cv_file__dev_ptc=no
        '''
    }
	stage (' *** BUILD PHASE ***'){
		sh'''#!/bin/bash
			make -j$(nproc) PYTHON_FOR_REGEN=python3.8
		'''
	}
	stage(' *** BINARY EXTRACTION IN $PREFIX ***'){
		sh'''#!/bin/bash
			make -j$(nproc) install
		'''
	}
	stage('*** TESTING PHASE ***'){
		sh'''#!/bin/bash
			source .vars
			cd $PREFIX/bin
			echo -e "\n[jenkinsfile INFO]: Creating helloworld.py to run test on"
			echo "print('Hello World inside Python !'" > helloworld.py
			echo -e "\n [jenkinsfile INFO]: Executing on qemu-riscv64 (linux-user)"
			qemu-riscv64 -L $RISCV_SYSROOT ./python3.8 helloworld.py
		'''
	}
}
